---
title: "ZIPG Demo"
author: "Roulan Jiang"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,comment = '')
```

```{r results='hide',warning=FALSE,error=FALSE,message=FALSE}
#setwd("~/ZIPG")
source("ZIPG_main.R")
```

## Load Data

Complete Dietary data can be find in "Daily sampling reveals personalized diet-microbiome associations in humans." (Johnson et al. 2019)

```{r}
load("Dietary.Rdata")
taxa_num = 15
taxa_string_select[taxa_num] # taxa name
W = dat$OTU[,taxa_num] # taxa count
M = dat$M # sequencing depth
X = cbind(1,dat$COV$ALC01,dat$COV$nutrPC1,dat$COV$nutrPC2) 
X_star = cbind(1,dat$COV$ALC01) 
ggplot(NULL)+
  geom_boxplot(aes(
  x = as.factor(X[,2]),y=log((W+0.5)/M)))+
  labs(title = taxa_string_select[taxa_num],
       x = 'ALC',y='Relative Abundance')+
  theme_bw()
```


## ZIPG Wald

Use function `ZIPG_main()` to run our ZIPG model.

**Input :**

W : Observed taxa count.

M : Sequencing depth.

X, X\_star : Covariats of interesting.

**Output list:**

ZIPG_res\$init : pscl results, used as initialization.

ZIPG_res\$res : ZIPG output evaluate at last EM iteration.

  ZIPG_res\$res\$par : ZIPG estimation $(\beta,\beta^*,\gamma)$.
  
ZIPG_res\$wald_test : ZIPG Wald test

ZIPG_res\$logli : ZIPG log-likelihood

```{r}
ZIPG_res <- ZIPG_main(W,M,X,X_star)
summary_ZIPG(ZIPG_res)
```


## ZIPG bWald

Set the bootstrap B in `bWald_list` to conduct ZIPG-bWald, results and covariance matirx can be find in ZIPG_res\$bWald.

```{r}
# Set bootstrap B
bWald_list = list(B = 100)
# Wait for a wile
ZIPG_res1 = ZIPG_main(
  W,M,X,X_star,
  optim_method,EM = TRUE,
  return_model = T,
  bWald_list = bWald_list)
summary_ZIPG(ZIPG_res1,type = 'bWald')
```

## ZIPG pbWald

Set the null hypothesis and bootstrap B in `pbWald_list` to conduct ZIPG-pbWald, results can be find in ZIPG_res\$pbWald

```{r}
# test beta1star, the 6th parameter
pbWald_list = list(
  d_index0 = c(1,2,3,4), 
  d_star_index0 = c(1),
  H0_index = 6,
  B = 100
)

ZIPG_res2 = ZIPG_main(
  W,M,X,X_star,
  optim_method,EM = TRUE,
  return_model = T,pbWald_list= pbWald_list)

summary_ZIPG(ZIPG_res2,type ='pbWald')
```

